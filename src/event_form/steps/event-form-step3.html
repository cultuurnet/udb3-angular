<div ng-controller="EventFormStep3Controller as EventFormStep3">

<section id="waar" ng-show="eventFormData.showStep3">
  <form name="step3Form" class="css-form">
    <h2 class="title-border">
      <span class="number">3</span>
      <span ng-show="eventFormData.isEvent">Waar vindt dit evenement of deze activiteit plaats?</span>
      <span ng-show="eventFormData.isPlace">Waar is deze plaats of locatie?</span>
    </h2>

    <div class="row">
      <div class="col-xs-12">
        <label for="gemeente-autocomplete" id="gemeente-label" ng-hide="selectedCity !== ''">Kies een gemeente</label>
        <div id="gemeente-kiezer" ng-hide="selectedCity !== ''">
          <span style="position: relative; display: inline-block; direction: ltr;" class="twitter-typeahead">
            <input type="text"
                   class="form-control typeahead"
                   placeholder="Gemeente of postcode"
                   ng-model="cityAutocompleteTextField"
                   typeahead="city as city.zip + ' ' + city.name for city in cities | filter:filterCities($viewValue) | orderBy:orderByLevenshteinDistance($viewValue)"
                   typeahead-on-select="selectCity($item, $label)"
                   typeahead-min-length="3">
          </span>
          <div class="alert alert-danger" ng-show="cityAutoCompleteError">
            <span class="help-block">Er was een probleem tijdens het ophalen van de steden</span>
          </div>
        </div>
        <div id="gemeente-gekozen" ng-show="selectedCity !== ''">
          <span class="btn-chosen" id="gemeente-gekozen-button" ng-bind="selectedCity"></span>
          <a href="" class="btn btn-default btn-link" ng-click="changeCitySelection()">Wijzigen</a>
        </div>
      </div>
    </div>

    <div id="waar-evenement" ng-show="eventFormData.isEvent && selectedCity !== ''">
      <div class="row">
        <div class="col-xs-12">
          <label id="locatie-label" ng-show="!selectedLocation">
            Kies een locatie <i class="fa fa-circle-o-notch fa-spin" ng-show="loadingPlaces"></i>
          </label>
          <div id="locatie-kiezer" ng-show="!selectedLocation" ng-hide="loadingPlaces">
            <span style="position: relative; display: inline-block; direction: ltr;" class="twitter-typeahead">
              <input type="text"
                     placeholder="Locatie"
                     class="form-control typeahead"
                     ng-model="locationAutocompleteTextField"
                     typeahead="location.id as location.name for location in filteredLocations = (locationsForCity | filter:filterCityLocations($viewValue)) | orderBy:orderCityLocations($viewValue) | limitTo:50"
                     typeahead-on-select="selectLocation($item, $model, $label)"
                     typeahead-min-length="3"
                     typeahead-template-url="templates/place-suggestion.html"/>
              <div class="plaats-adres-resultaat dropdown-menu-no-results"
                   ng-show="filteredLocations.length === 0 && locationsSearched">
                <p class="text-center">
                  Locatie niet gevonden?<br />
                  <button type="button" class="btn btn-primary" data-toggle="modal"
                          data-target="#waar-locatie-toevoegen" ng-click="openPlaceModal()">
                    Een locatie toevoegen
                  </button>
                </p>
              </div>
            </span>
            <div class="alert alert-danger" ng-show="locationAutoCompleteError">
              <span class="help-block">Er was een probleem tijdens het ophalen van de locaties</span>
            </div>
          </div>
          <div id="locatie-gekozen" ng-show="selectedLocation" >
            <span ng-bind="selectedLocation.name"></span> <span ng-bind="selectedLocation.address.streetAddress"></span>
            <button type="button" class="btn btn-default btn-link" data-toggle="modal"
                    data-target="#waar-locatie-toevoegen"ng-click="changeLocationSelection()">Wijzigen</button>
          </div>
        </div>
      </div>


    </div>

    <div id="waar-plaats" ng-show="eventFormData.isPlace && selectedCity !== ''">
      <div class="plaats-adres-ingeven col-sm-6" ng-hide="selectedLocation" >
        <div class="row">
          <div class="col-xs-12">
            <div class="form-group" ng-class="{'has-error' : showValidation && step3Form.street.$error.required }">
              <label>Straat en nummer</label>
              <input class="form-control" id="straat" name="street" placeholder="" type="text" ng-model="placeStreetAddress" required>
              <span class="help-block" ng-show="showValidation && step3Form.street.$error.required">Straat en nummer is een verplicht veld.</span>
            </div>
          </div>
        </div>
        <a class="btn btn-primary plaats-ok" ng-click="validatePlace()">OK</a>
      </div>

      <div class="plaats-adres-resultaat" ng-show="selectedLocation">
        <p>
          <span class="btn-chosen" ng-bind="selectedLocation.name"></span>
          <a class="btn btn-link plaats-adres-wijzigen" ng-click="changeStreetAddress()">Wijzigen</a>
        </p>
      </div>

    </div>

  </form>
</section>

</div>
